<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-devops/cicd/gitlab/gitlab-reactjs-ci-cd" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Deploy A ReactJS App with Gitlab(Self-hosted) CI/CD | Technical Tutorial</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/TechnicalTutorial/docs/devops/cicd/gitlab/gitlab-reactjs-ci-cd"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Deploy A ReactJS App with Gitlab(Self-hosted) CI/CD | Technical Tutorial"><meta data-rh="true" name="description" content="This article is mainly referred from GitLab CI/CD example with a dockerized ReactJS App ðŸš€, I just made some personalized changes for my notes as learning purpose."><meta data-rh="true" property="og:description" content="This article is mainly referred from GitLab CI/CD example with a dockerized ReactJS App ðŸš€, I just made some personalized changes for my notes as learning purpose."><link data-rh="true" rel="icon" href="/TechnicalTutorial/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/TechnicalTutorial/docs/devops/cicd/gitlab/gitlab-reactjs-ci-cd"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/TechnicalTutorial/docs/devops/cicd/gitlab/gitlab-reactjs-ci-cd" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/TechnicalTutorial/docs/devops/cicd/gitlab/gitlab-reactjs-ci-cd" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/TechnicalTutorial/resume/rss.xml" title="Technical Tutorial RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/TechnicalTutorial/resume/atom.xml" title="Technical Tutorial Atom Feed"><link rel="stylesheet" href="/TechnicalTutorial/assets/css/styles.9816e46e.css">
<script src="/TechnicalTutorial/assets/js/runtime~main.b1314880.js" defer="defer"></script>
<script src="/TechnicalTutorial/assets/js/main.b06cc41b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_Fcti" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/TechnicalTutorial/"><div class="navbar__logo"><img src="/TechnicalTutorial/img/logo.svg" alt="Technical Skills" class="themedComponent_vw9e themedComponent--light_X8li"><img src="/TechnicalTutorial/img/logo.svg" alt="Technical Skills" class="themedComponent_vw9e themedComponent--dark_XK36"></div><b class="navbar__title text--truncate">Technical Skills</b></a><a class="navbar__item navbar__link" href="/TechnicalTutorial/docs/scrum/scrum-concepts">Scrum</a><a class="navbar__item navbar__link" href="/TechnicalTutorial/docs/languages/intro">Languages</a><a class="navbar__item navbar__link" href="/TechnicalTutorial/docs/cloud-infrastructure/intro">Cloud Infrastructure</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/TechnicalTutorial/docs/devops/intro">DevOps</a><a class="navbar__item navbar__link" href="/TechnicalTutorial/docs/dataops/intro">DataOps</a><a class="navbar__item navbar__link" href="/TechnicalTutorial/docs/software-development/intro">Software Development</a><a class="navbar__item navbar__link" href="/TechnicalTutorial/docs/ides-and-dev-tools/intro">IDEs &amp; Dev Tools</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/TechnicalTutorial/resume">Resume</a><a href="https://github.com/PFTian/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_SPiH"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_qFPC colorModeToggle__Dgc"><button class="clean-btn toggleButton_r8nl toggleButtonDisabled_Bf6S" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_V9fX"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_V2ie"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_tUn5"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_juSb"><div class="docsWrapper_EIHb"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RnRE" type="button"></button><div class="docRoot_RpBZ"><aside class="theme-doc-sidebar-container docSidebarContainer_m6qY"><div class="sidebarViewport_R_ZS"><div class="sidebar_VeEV"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_iEUx"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/TechnicalTutorial/docs/devops/intro">intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/TechnicalTutorial/docs/devops/git/branching-strategy">Git</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/TechnicalTutorial/docs/devops/cicd/intro">CICD</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/TechnicalTutorial/docs/devops/cicd/intro">intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/TechnicalTutorial/docs/devops/cicd/canary-deployment">Canary Deployement</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/TechnicalTutorial/docs/devops/cicd/github/intro">GitHub</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/TechnicalTutorial/docs/devops/cicd/gitlab/gitlab-installation-ubuntu">GitLab</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/TechnicalTutorial/docs/devops/cicd/gitlab/gitlab-installation-ubuntu">Gitlab Installation on Ubuntu 20.04 LTS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/TechnicalTutorial/docs/devops/cicd/gitlab/gitlab-runner-installation-ubuntu">Install Gitlab Runner on Ubuntu 20.04 LTS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/TechnicalTutorial/docs/devops/cicd/gitlab/gitlab-backup-and-restore">Migrate Gitlab from one server to another</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/TechnicalTutorial/docs/devops/cicd/gitlab/gitlab-reactjs-ci-cd">Deploy A ReactJS App with Gitlab(Self-hosted) CI/CD</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/TechnicalTutorial/docs/devops/containerization/intro">Containerization</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/TechnicalTutorial/docs/devops/security/snyk">Security</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_l7w_"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Oso4"><div class="docItemContainer_wfoJ"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_NOSR" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/TechnicalTutorial/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_WmEB"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">CICD</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">GitLab</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Deploy A ReactJS App with Gitlab(Self-hosted) CI/CD</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_Cm4U theme-doc-toc-mobile tocMobile_vepl"><button type="button" class="clean-btn tocCollapsibleButton_gyNk">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Deploy A ReactJS App with Gitlab(Self-hosted) CI/CD</h1></header>
<p>This article is mainly referred from <a href="https://dev.to/christianmontero/gitlab-ci-cd-example-with-a-dockerized-reactjs-app-1cda" target="_blank" rel="noopener noreferrer">GitLab CI/CD example with a dockerized ReactJS App ðŸš€</a>, I just made some personalized changes for my notes as learning purpose.</p>
<h2 class="anchor anchorWithStickyNavbar_gnyd" id="1-setup-a-gitlab-service-on-a-server">1. Setup a Gitlab service on a server<a href="#1-setup-a-gitlab-service-on-a-server" class="hash-link" aria-label="Direct link to 1. Setup a Gitlab service on a server" title="Direct link to 1. Setup a Gitlab service on a server">â€‹</a></h2>
<p>Your can follow <a href="https://github.com/PFTian/TechNotes/blob/master/Gitlab/Gitlab%20Installation.md" target="_blank" rel="noopener noreferrer">Gitlab Installation on Ubuntu 20.04 LTS</a> or <a href="https://about.gitlab.com/install/#ubuntu" target="_blank" rel="noopener noreferrer">offical document</a> to install Gitlab on a new Ubuntu server.</p>
<p>Basically we just need to do</p>
<ul>
<li>
<p>Install and configure the necessary dependencies</p>
<div class="language-bash codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-bash codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get install -y curl openssh-server ca-certificates tzdata perl</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Install Postfix</p>
<div class="language-bash codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-bash codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get install -y postfix</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Choose <code>Internet Site</code> and use your server&#x27;s external DNS as <code>mail name</code>.</p>
</li>
<li>
<p>Add the GitLab package repository and install the package</p>
<div class="language-bash codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-bash codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.deb.sh | sudo bash</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Use your domain name as parameter to install the gitlab</p>
<div class="language-bash codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-bash codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">sudo EXTERNAL_URL=&quot;https://gitlab.yourdomain.com&quot; apt-get install gitlab-ee</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_gnyd" id="2-install-a-gitlab-runner-better-on-a-seperate-machine">2. Install a Gitlab Runner (Better on A Seperate Machine)<a href="#2-install-a-gitlab-runner-better-on-a-seperate-machine" class="hash-link" aria-label="Direct link to 2. Install a Gitlab Runner (Better on A Seperate Machine)" title="Direct link to 2. Install a Gitlab Runner (Better on A Seperate Machine)">â€‹</a></h2>
<p>Gitlab runner is an application that runs Giltab jobs in pipelines</p>
<blockquote>
<p>You should install GitLab Runner on a machine thatâ€™s separate from the one that hosts the GitLab instance for security and performance reasons.</p>
</blockquote>
<p>You can follow <a href="https://github.com/PFTian/TechNotes/blob/master/Gitlab/Gitlab%20Runner%20Installation%20on%20Ubuntu%2020.04%20LTS.md" target="_blank" rel="noopener noreferrer">Gitlab Runner Installation on Ubuntu 20.04 LTS</a> or <a href="https://docs.gitlab.com/runner/install/linux-manually.html" target="_blank" rel="noopener noreferrer">offical document</a> to install gitlab runner on a seperate Ubuntu server.</p>
<p>Simply you just need to do</p>
<ul>
<li>
<p>Download the latest <code>deb</code> file</p>
<div class="language-bash codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-bash codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">curl -LJO https://gitlab-runner-downloads.s3.amazonaws.com/latest/deb/gitlab-runner_amd64.deb</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Install the package</p>
<div class="language-bash codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-bash codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">sudo dpkg -i gitlab-runner_amd64.deb</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Register your runner with command</p>
<div class="language-bash codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-bash codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">sudo gitlab-runner register</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Enter your Gitlab instance URL</p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://gitlab.yourdomain.com</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Enter the token you obtained to register the Runner:</p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">Please enter the gitlab-ci token for this runner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Register Token</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_gnyd" id="3-create-a-new-project-on-gitlab">3. Create a New Project on Gitlab<a href="#3-create-a-new-project-on-gitlab" class="hash-link" aria-label="Direct link to 3. Create a New Project on Gitlab" title="Direct link to 3. Create a New Project on Gitlab">â€‹</a></h2>
<p>Login to your Gitlab and create a new project (I will name it bright-future)</p>
<ul>
<li>
<p>Click <code>New project</code>
<img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116002743-bd9f3980-a62d-11eb-9894-92f2c62dd49c.png" alt="image" class="img_GMwV"></p>
</li>
<li>
<p>Choose <code>Create blank project</code>
<img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116002892-4f0eab80-a62e-11eb-8182-b874f968df9d.png" alt="image" class="img_GMwV"></p>
</li>
<li>
<p>Fill the project information and click <code>Create project</code>
<img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116002834-166ed200-a62e-11eb-8fcc-e9bac09df966.png" alt="image" class="img_GMwV"></p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_gnyd" id="3-create-a-reactjs-application-and-push-to-gitlab-repository">3. Create a ReactJS Application and Push to Gitlab repository<a href="#3-create-a-reactjs-application-and-push-to-gitlab-repository" class="hash-link" aria-label="Direct link to 3. Create a ReactJS Application and Push to Gitlab repository" title="Direct link to 3. Create a ReactJS Application and Push to Gitlab repository">â€‹</a></h2>
<ul>
<li>
<p>On your local machine, initialise a project called <code>bright-future</code> as well.</p>
<div class="language-bash codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-bash codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">npx create-react-app bright-future</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>After creating the project successfully, we run the project</p>
<div class="language-bash codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-bash codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">cd bright-future</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm start</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>If everything is install correctly, you will see a default webpage shows as below on <a href="http://localhost:3000/" target="_blank" rel="noopener noreferrer">http://localhost:3000/</a>
<img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116003343-17a0fe80-a630-11eb-8d46-049737f2f283.png" alt="image" class="img_GMwV"></p>
</li>
<li>
<p>Check test passes
Run the <code>test</code> command</p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">npm test</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the console prompt, press <code>a</code> to run all tests, if everything goes well, we will see</p>
<p><img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116003979-41a7f000-a633-11eb-95bd-e1d7a69797e2.png" alt="image" class="img_GMwV"></p>
</li>
<li>
<p>Push the project to your Gitlab repository</p>
<div class="language-bash codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-bash codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">git init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git remote add origin https://gitlab.yourdomain.cn/root/bright-future.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git add .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git commit -m &quot;Initial commit&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git push -u origin master</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Refresh the Gitlab repository, you will see your <code>Bright Future</code> has been listed there.
<img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116003800-2dafbe80-a632-11eb-9136-411848b6ce11.png" alt="image" class="img_GMwV"></p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_gnyd" id="4-dockerize-our-application-on-nginx">4. Dockerize our application on Nginx<a href="#4-dockerize-our-application-on-nginx" class="hash-link" aria-label="Direct link to 4. Dockerize our application on Nginx" title="Direct link to 4. Dockerize our application on Nginx">â€‹</a></h2>
<p>We will use <a href="https://docs.docker.com/develop/develop-images/multistage-build/" target="_blank" rel="noopener noreferrer">Docker multi-stage builds</a> to create a Nginx image with compiled app in the end. You can obviously choose to use Nodejs image to run your app in a docker container, but using Ngnix image to deploy app is a thinner and more efficient way.</p>
<ul>
<li>
<p>Add <code>.dockerignore</code> for <code>node_modules</code> folder at the root of your <code>bright-future</code> project, since this file is usually huge and docker can help you download all the dependencies.</p>
</li>
<li>
<p>Create a <code>Dockerfile</code> and add a build stage</p>
<p>Since ReactJS application is based on Node.js, we still Node.js to build and compile the application.</p>
<p>At the build stage, add the below code to the <code>Dockerfile</code></p>
<div class="language-dockerfile codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain"># Build stage: based on Node.js, build and compile the application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM node:14.16.1-alpine3.13 as build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Docker work directory, docker will create an `/app` folder and all the next steps will happen in this directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy your application to the container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY . /app/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Prepare the container for building React</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Build your application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN npm run build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Nginx stage: deploy build/compiled app to Nginx.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#Prepare nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM nginx:1.19.10-alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy application build files from build stage above to nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=build /app/build /usr/share/nginx/html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Delete the default Nginx configration file and copy your Nginx configuration file to the container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN rm /etc/nginx/conf.d/default.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY nginx/nginx.conf /etc/nginx/conf.d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#Fire up the Nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#If you add a custom CMD in the Dockerfile, be sure to include -g daemon off; in the CMD in order for nginx to stay in the foreground, so that Docker can track the process properly (otherwise your container will stop immediately after starting)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Create Nginx configuration file</p>
<p>You can see from the above step that we use our own nginx configration file. So that your root of the porject, create a folder called <code>nginx</code> add the below nginx configuration code and named it <code>nginx.conf</code></p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen 80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        root /usr/share/nginx/html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        index index.html index.htm;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try_files $uri $uri/ /index.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_page 500 502 503 504 /50x.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location /50x.html {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        root /usr/share/nginx/html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Now, we try to create our docker image locally to see if all above steps work.</p>
<p>Open your project, if you create the files correctly, your project file structure should look like as below</p>
<p><img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116006377-83d62f00-a63d-11eb-9f0b-9e7ceb151e55.png" alt="image" class="img_GMwV"></p>
<p>Now open the terminal and make sure you are at the root of your project folder and run</p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">docker build -t bright-future:1.0 .</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Docker will output lots of log messages, and if we create our image successfully, we can check the image by using</p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">docker images</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>if you see the below line, we can verify that we have created a nginx dcoker with out application
<img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116007288-a0746600-a641-11eb-81b4-f1ed9466f324.png" alt="image" class="img_GMwV"></p>
<p>Fire up a docker container based on the image we created</p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">docker run -d --rm --name bright-future -p 5000:80 -t bright-future:1.0</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now you can go to <a href="http://localhost:5000" target="_blank" rel="noopener noreferrer">http://localhost:5000</a> and see our dockerlised app running.</p>
<p><img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116007341-e92c1f00-a641-11eb-8d5d-a0817a32fbf6.png" alt="image" class="img_GMwV"></p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_gnyd" id="5-gitlab-pipelines">5. Gitlab Pipelines<a href="#5-gitlab-pipelines" class="hash-link" aria-label="Direct link to 5. Gitlab Pipelines" title="Direct link to 5. Gitlab Pipelines">â€‹</a></h2>
<p>Gitlab uses <code>gitlab-ci.yml</code> to run the pipelines. So we need to create a <code>gitlab-ci.yml</code> file at the root of the project folder.</p>
<p>Once we added the <code>gitlab-ci.yml</code> file and push it to the Gitlab repository, Gitlab will detect this file and Gitlab-runner will go through the file and run all jobs that we specific there.</p>
<p>In this article, we will create 4 stages as example to demonstrate how Gitlab pipeline works</p>
<ul>
<li>build</li>
<li>test</li>
<li>docker-build</li>
<li>deploy</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_gnyd" id="51-pipelines---build">5.1 Pipelines - build<a href="#51-pipelines---build" class="hash-link" aria-label="Direct link to 5.1 Pipelines - build" title="Direct link to 5.1 Pipelines - build">â€‹</a></h3>
<p>Let&#x27;s first create a build stage for pipelines. See the below example:</p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">stages:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stage: build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  image: node:14.16.1-alpine3.13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  before_script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - echo &quot;Start building app...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - npm run build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - echo &quot;Build successfully&quot;</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Commit and push your code to your self-hosted Gitlab. You will see there is a <code>build</code> stage on your project piplines.</p>
<img width="634" alt="image" src="https://user-images.githubusercontent.com/10986601/116027198-d12abe80-a686-11eb-95e9-c2a60197aeba.png">
<p>If everything runs well, it should show <code>passed</code>.</p>
<img width="628" alt="image" src="https://user-images.githubusercontent.com/10986601/116027270-00d9c680-a687-11eb-88af-6e26207e453d.png">
<h3 class="anchor anchorWithStickyNavbar_gnyd" id="52-pipelines---test">5.2 Pipelines - test<a href="#52-pipelines---test" class="hash-link" aria-label="Direct link to 5.2 Pipelines - test" title="Direct link to 5.2 Pipelines - test">â€‹</a></h3>
<p>After <code>build</code>, we should add a test stage to check if all the test pass.</p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">stages:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stage: build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  image: node:14.16.1-alpine3.13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  before_script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - echo &quot;Start building app...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - npm run build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - echo &quot;Build successfully&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stage: test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  image: node:14.16.1-alpine3.13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  before_script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - echo &quot;Start testing app...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - npm test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - echo &quot;Test successfully!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Commit and push your code, the test stage will also be added on the piplines</p>
<img width="661" alt="image" src="https://user-images.githubusercontent.com/10986601/116028981-e3a6f700-a68a-11eb-93e6-7986a59f1285.png">
<p>If everything runs well, both build and test should show <code>passed</code>.</p>
<img width="579" alt="image" src="https://user-images.githubusercontent.com/10986601/116029154-3da7bc80-a68b-11eb-980d-ef349068c09b.png">
<p>Till now, we have 2 stages (build and test) to show how piplines work. We build the app at first and then run the test in sequence. You might be curious why we run <code>npm install</code> two times in two stages? That is because each job runs in a new empty docker container instance and we don&#x27;t have any data from previous jobs. In order to share data among stages, we need to use artifacts or cache, what is the difference? Here is the answer from Gitlab offical document.</p>
<blockquote>
<p><strong>Cache vs artifacts</strong></p>
<p>If you use cache and artifacts to store the same path in your jobs, the cache might be overwritten because caches are restored before artifacts.
Donâ€™t use caching for passing artifacts between stages, as it is designed to store runtime dependencies needed to compile the project:</p>
<ul>
<li><code>cache</code>: <strong>For storing project dependencies</strong>
Caches can increase the speed of a given job in subsequent pipelines. You can store downloaded dependencies so that they donâ€™t have to be fetched from the internet again. Dependencies include things like npm packages, Go vendor packages, and so on. You can configure a cache to pass intermediate build results between stages, but you should use artifacts instead.</li>
<li><code>artifacts</code>: <strong>Use for stage results that are passed between stages.</strong>
Artifacts are files that are generated by a job so they can be stored and uploaded. You can fetch and use artifacts in jobs in later stages of the same pipeline. You canâ€™t create an artifact in a job in one stage, and use this artifact in a different job in the same stage. This data is not available in different pipelines, but can be downloaded from the UI.</li>
</ul>
<p>If you download modules while building your application, you can declare them as artifacts and subsequent stage jobs can use them.</p>
<p>You can define an expiry time so artifacts are deleted after a defined time. Use dependencies to control which jobs fetch the artifacts.</p>
<p>Artifacts can also be used to make files available for download after a pipeline completes, like a build image.</p>
</blockquote>
<p>Let&#x27;s improve our script with below code:</p>
<div class="language-yml codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-yml codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">stages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">14.16.1</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">alpine3.13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">before_script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;Start building app</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> npm run build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;Build successfully&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">artifacts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">expire_in</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1 hour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> node_modules/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">14.16.1</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">alpine3.13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">before_script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;Start testing app</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> npm test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;Test successfully</span><span class="token tag" style="color:#00009f">!</span><span class="token plain">&quot;</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Commit and push your code, you should get the same result but more faster.</p>
<h3 class="anchor anchorWithStickyNavbar_gnyd" id="53-pipelines---docker-build">5.3 Pipelines - Docker Build<a href="#53-pipelines---docker-build" class="hash-link" aria-label="Direct link to 5.3 Pipelines - Docker Build" title="Direct link to 5.3 Pipelines - Docker Build">â€‹</a></h3>
<p>Now it&#x27;s time to dockerlise our project in a Nginx docker image just like what we did at step 3. We will use docker in docker to buid this image.</p>
<p><strong><em>IMPORTANT:</em></strong>
Based on the offical document <a href="https://docs.gitlab.com/ee/ci/docker/using_docker_build.html" target="_blank" rel="noopener noreferrer">here</a>,</p>
<blockquote>
<p>If you want to use Docker-in-Docker, you must always use privileged = true in your Docker containers.</p>
</blockquote>
<p>So we should register a new runner with <code>privileged</code> enabled.</p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">sudo gitlab-runner register -n --url https://gitlab.yourdomian.com/ --registration-token REGISTRATION_TOKEN --executor docker --description &quot;My Docker Runner&quot; --docker-image &quot;docker:20.10.6-dind&quot;  --docker-privileged --docker-volumes &quot;/certs/client&quot;</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>otherwise, you probably get an error like below when running the pipelines process</p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">error during connect: Post http://docker:2375/v1.24/auth: dial tcp: lookup docker on 168.63.129.16:53: no such host</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cleaning up file based variables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ERROR: Job failed: exit code 1</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<img width="806" alt="image" src="https://user-images.githubusercontent.com/10986601/116033306-c3c80100-a693-11eb-80b6-c55b9c77313a.png">
<p><strong><em>Note:</em></strong>
If you register a new runner with <code>privileged</code> enabled, you should use this new runner to run the docker in docker jobs. You may can choose to delete the older runner in <code>/etc/gitlab-runner/config.toml</code> file or using gitlab-runner <code>tags</code> to specify which runner to excute which specific jobs with the same <code>tags</code>.</p>
<p>Add the below code to your <code>.gitlab-ci.yml</code></p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">stages:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - docker-build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stage: build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  image: node:14.16.1-alpine3.13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  before_script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - echo &quot;Start building app...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - npm run build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - echo &quot;Build successfully&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  artifacts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    expire_in: 1 hour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    paths:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - node_modules/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stage: test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  image: node:14.16.1-alpine3.13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  before_script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - echo &quot;Start testing app...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - npm test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - echo &quot;Test successfully!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker-build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stage: docker-build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  image: docker:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  services:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: docker:20.10.6-dind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  before_script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - docker login --username &quot;$CI_REGISTRY_USER&quot; --password &quot;$CI_REGISTRY_PASSWORD&quot; $CI_REGISTRY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - docker build --pull -t $CI_REGISTRY_IMAGE .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - docker push $CI_REGISTRY_IMAGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - echo &quot;Registry Image:&quot; $CI_REGISTRY_IMAGE</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Commit and push your code. You will see a new <code>docker-build</code> is added and passed.</p>
<img width="729" alt="image" src="https://user-images.githubusercontent.com/10986601/116048363-aef56880-a6a7-11eb-8dd9-5b5f8caec46e.png">
<p>Now go to your project side bar and click <code>Packages &amp; Registries</code> -&gt; <code>Container Registry</code>, you will also find the image that you just built by docker in docker has been uploaded to your project <code>Container Registry</code>.</p>
<img width="1016" alt="image" src="https://user-images.githubusercontent.com/10986601/116048664-f976e500-a6a7-11eb-8956-c8187818a2af.png">
<p><strong>Predefined Environment Variables:</strong></p>
<p>In this section, we also use Gitlab <a href="https://docs.gitlab.com/ee/ci/variables/predefined_variables.html" target="_blank" rel="noopener noreferrer">Predefined Environment Variables</a>. I listed the ones that we used in this phase at below:</p>
<ul>
<li>
<p><strong>CI_REGISTRY_USER -</strong> The username to push containers to the projectâ€™s GitLab Container Registry. Only available if the Container Registry is enabled for the project.</p>
</li>
<li>
<p><strong>CI_REGISTRY_PASSWORD -</strong> The password to push containers to the projectâ€™s GitLab Container Registry. Only available if the Container Registry is enabled for the project.</p>
</li>
<li>
<p><strong>CI_REGISTRY -</strong> The address of the GitLab Container Registry. Only available if the Container Registry is enabled for the project. This variable includes a <!-- -->:port<!-- --> value if one is specified in the registry configuration.</p>
</li>
<li>
<p><strong>CI_REGISTRY_IMAGE -</strong> The address of the projectâ€™s Container Registry. Only available if the Container Registry is enabled for the project.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_gnyd" id="54-pipelines---deploy">5.4 Pipelines - deploy<a href="#54-pipelines---deploy" class="hash-link" aria-label="Direct link to 5.4 Pipelines - deploy" title="Direct link to 5.4 Pipelines - deploy">â€‹</a></h3>
<p>With the docker images that we uploaded to project container registry, we can deploy our application either on the server or a cloud platform</p>
<h4 class="anchor anchorWithStickyNavbar_gnyd" id="541-deploy-to-a-server">5.4.1 Deploy to a server<a href="#541-deploy-to-a-server" class="hash-link" aria-label="Direct link to 5.4.1 Deploy to a server" title="Direct link to 5.4.1 Deploy to a server">â€‹</a></h4>
<p>If you have your personal server, you can deploy your app on your own app. The article that I refered uses <code>Digital Ocean</code> to set up a new server. You can click this <a href="https://dev.to/christianmontero/gitlab-ci-cd-example-with-a-dockerized-reactjs-app-1cda" target="_blank" rel="noopener noreferrer">link</a> to check the details. You can of course choose other VPS providers like <code>Linode</code> and <code>Vultr</code> or cloud providers like <code>Azure</code> and <code>AWS</code>.</p>
<ul>
<li>
<p>Open your terminal and login to your server remotely with</p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">ssh root@&lt;server_ip&gt;</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><a href="https://dev.to/christianmontero/gitlab-ci-cd-example-with-a-dockerized-reactjs-app-1cda" target="_blank" rel="noopener noreferrer">Install the Docker </a> on the server</p>
</li>
<li>
<p>Let&#x27;s try to pull the image from our <code>Container Registry</code> and check if the image has been built successfully.</p>
<ul>
<li>
<p>Open the project on the Gitlab</p>
</li>
<li>
<p>Go to <code>Packages &amp; Registry</code> -&gt; <code>Container Registry</code></p>
</li>
<li>
<p>Click <code>CLI Commands</code> on the top right and find the registry information</p>
<img width="315" alt="image" src="https://user-images.githubusercontent.com/10986601/116053285-17931400-a6ad-11eb-838e-634191431d2c.png">
</li>
<li>
<p>Go back to your deploy server, and login the container registry by</p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">docker login gitlab.&lt;yourdomain&gt;.com:5050</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Input your <code>username</code> and <code>password</code></p>
</li>
<li>
<p>Pull image with using</p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">docker pull gitlab.&lt;yourdomain&gt;.com: 5050/root/bright-future[:tag]</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Run <code>docker ps -a</code> to check if image has been downloaded successfully.</p>
</li>
<li>
<p>You can run the docker container manully by
<code>docker run -p 8000:80 -d --name bright-future gitlab.&lt;yourdomain&gt;.com:5050/root/bright-future</code>
If above steps run very well, you can see your <code>bright-future</code> has been deployed manully on <code>http://your_server_ip:8000</code>.</p>
<img width="1350" alt="image" src="https://user-images.githubusercontent.com/10986601/116056022-e700a980-a6af-11eb-95fd-1ce0e910bafd.png">
</li>
</ul>
<p><strong><em>Note:</em></strong> If your VPS/Cloud Providers has their own port security rules, the port 8000 might be blocked and need you to open it by yourself.</p>
<p>Now that we verify that our server is running perfectly and we can run our app there. Next, we need to store our server&#x27;s ssh private key and IP address as an environment variable in our GitLab project so that our Gitlab can access the deploy server remotely, like how we login the server by opening a terminal.</p>
</li>
<li>
<p>Create your ssh private/public key pairs on your server by</p>
<div class="language-bash codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-bash codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen -m PEM -t rsa -b 4096 -C &quot;your_email@example.com&quot;</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It will ask you for a file to save the key, just type enter to use the default one, then it will ask you for a passphrase, for this example let&#x27;s leave it empty and press enter a couple of times, and then you will see a successful message, then we need to copy our private key add it to our project on GitLab, we can run this command to see the our private key.</p>
</li>
<li>
<p>Check your ssh private key at <code>~/.ssh/id_rsa</code></p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">cat ~/.ssh/id_rsa</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Copy all the content from the terminal</p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">-----BEGIN RSA PRIVATE KEY-----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MIIJKAIBAAKCAgEArPK6v04pwEn1xkGy4CCMkA6pNafxs4S8xKM6iq8aXE00ka6z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----END RSA PRIVATE KEY-----</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Open your project on gitlab. On the side bar, Click <code>Settings</code> -&gt; <code>CI/CD</code> -&gt; <code>Variables</code> -&gt; <code>Expand</code>.</p>
<ul>
<li>Click the <code>Add Variable</code> button.</li>
<li>Input <code>SSH_PRIVATE_KEY</code> as Key</li>
<li>Input copied private key from above step as value</li>
<li>Choose Type as <code>File</code>
<img width="768" alt="image" src="https://user-images.githubusercontent.com/10986601/116058612-96d71680-a6b2-11eb-8674-facfe934e355.png">
</li>
<li>Click <code>Add Variable</code> to save the variable.</li>
</ul>
</li>
<li>
<p>Then we add another varialbe called <code>SERVER_IP</code> with your <code>&lt;server_ip&gt;</code> as value. Choose Type as <code>Variable</code>.</p>
<img width="768" alt="image" src="https://user-images.githubusercontent.com/10986601/116061331-5036eb80-a6b5-11eb-9568-06180b4107cd.png">
<p>Finally, you will have two variables added to your project on Gitlab.</p>
<img width="911" alt="image" src="https://user-images.githubusercontent.com/10986601/116061498-82484d80-a6b5-11eb-8dce-60c84e113586.png">
</li>
<li>
<p>Add the below script to your <code>.gitlab-ci.yml</code> file.</p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">stages:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- docker-build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stage: build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">image: node:14.16.1-alpine3.13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">before_script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - echo &quot;Start building app...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - npm run build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - echo &quot;Build successfully&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">artifacts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    expire_in: 1 hour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    paths:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - node_modules/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stage: test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">image: node:14.16.1-alpine3.13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">before_script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - echo &quot;Start testing app...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - npm test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - echo &quot;Test successfully!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker-build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stage: docker-build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">image: docker:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: docker:20.10.6-dind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">before_script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - docker login --username &quot;$CI_REGISTRY_USER&quot; --password &quot;$CI_REGISTRY_PASSWORD&quot; $CI_REGISTRY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - docker build --pull -t $CI_REGISTRY_IMAGE .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - docker push $CI_REGISTRY_IMAGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - echo &quot;Registry Image:&quot; $CI_REGISTRY_IMAGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deploy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stage: deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">image: kroniak/ssh-client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">before_script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - echo &quot;Deploying app for development environment&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - chmod 400 $SSH_PRIVATE_KEY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ssh -o StrictHostKeyChecking=no -i $SSH_PRIVATE_KEY root@$SERVER_IP &quot;docker login --username &quot;$CI_REGISTRY_USER&quot; --password &quot;$CI_REGISTRY_PASSWORD&quot; $CI_REGISTRY&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ssh -o StrictHostKeyChecking=no -i $SSH_PRIVATE_KEY root@$SERVER_IP &quot;docker pull $CI_REGISTRY_IMAGE&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ssh -o StrictHostKeyChecking=no -i $SSH_PRIVATE_KEY root@$SERVER_IP &quot;docker stop bright-future || true &amp;&amp; docker rm bright-future || true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ssh -o StrictHostKeyChecking=no -i $SSH_PRIVATE_KEY root@$SERVER_IP &quot;docker run -p 80:80 -d --rm --name bright-future $CI_REGISTRY_IMAGE&quot;</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>What are we doing at the deploy stage?</p>
<p>In order to make auto deploy happens, we need to establish a ssh connection between our pipeline and our server.</p>
<p>You can think that now gitlab login to our server remotely and pull the image from our Gitlab <code>Container Registry</code> and run the docker container that contains our application</p>
<p>We use an image with a ssh client (kroniak/ssh-client) and run our commands one by one.</p>
<h3 class="anchor anchorWithStickyNavbar_gnyd" id="congratulations">Congratulations!<a href="#congratulations" class="hash-link" aria-label="Direct link to Congratulations!" title="Direct link to Congratulations!">â€‹</a></h3>
<p>If you follow the steps correctly, I think you have setup a simple CI/CD pipelines for a ReactJS project on your self-hosted Gitlab repostory.</p>
<p>Now if you made some changes locally and push these changes to your Gitlab on master branch. Your app will also be deployed in a docker Nginx container on your server automatically.</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_gnyd" id="542-deploy-to-azure-app-service">5.4.2 Deploy to Azure App Service<a href="#542-deploy-to-azure-app-service" class="hash-link" aria-label="Direct link to 5.4.2 Deploy to Azure App Service" title="Direct link to 5.4.2 Deploy to Azure App Service">â€‹</a></h4>
<p>You can also choose to deploy your application from your project <code>Container Registry</code> to an Azure app service.</p>
<ul>
<li>
<p>Login to your <a href="https://portal.azure.com/" target="_blank" rel="noopener noreferrer">Azure Portal</a></p>
</li>
<li>
<p>Click the <code>App Services</code> button on the top
<img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116179339-bff6b600-a749-11eb-8138-c25e01576262.png" alt="image" class="img_GMwV"></p>
</li>
<li>
<p>Click <code>Create</code> in the <code>App Serivces</code> Page.
<img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116179561-28459780-a74a-11eb-9e5b-ee0392a90ffc.png" alt="image" class="img_GMwV"></p>
</li>
<li>
<p>At <code>Create Web App</code> -&gt; <code>Basics</code> page</p>
<ul>
<li>Choose the <code>Subscription</code> and <code>Resource Group</code></li>
<li>Fill the instance name, choose the <code>Docker Container</code> as Publish and Pick a <code>Region</code>.</li>
<li>Choose a App Service Plan, Here for demo purpose, I am using <code>Free F1 1GB memory</code> which is enough for this article.
<img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116180501-98a0e880-a74b-11eb-9969-1d6c31f51539.png" alt="image" class="img_GMwV"></li>
</ul>
</li>
<li>
<p>At <code>Create Web App</code> -&gt; <code>Docker</code> page</p>
<ul>
<li>Choose <code>Single Container</code> as options</li>
<li>Choose <code>Private Registry</code> as Image Source</li>
<li>Fill <code>Private registry options</code> based on your project, Here is mine
<img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116183257-25e63c00-a750-11eb-8405-ea62c6553d90.png" alt="image" class="img_GMwV"></li>
</ul>
</li>
<li>
<p>Click <code>Review + create</code> at Bottom to create App Service.</p>
</li>
<li>
<p>After App Service set up, go to your app service <code>Overview</code> page and click the <code>URL</code>
<img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116184311-1a941000-a752-11eb-9184-d13f643e2fbb.png" alt="image" class="img_GMwV">
You will see your web application has been published on the App Service
<img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116192193-140c9500-a760-11eb-87b8-7d188ac6508c.png" alt="image" class="img_GMwV"></p>
</li>
<li>
<p>Enable the continuous deployment. Go to app service side bar and Click <code>Deployment Center</code> under <code>Deployment</code> section.</p>
</li>
<li>
<p>On the <code>Settings</code> page, turn the <code>Continuous deployment</code> on
<img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116185145-9b074080-a753-11eb-873d-818bbd54461c.png" alt="image" class="img_GMwV"></p>
</li>
<li>
<p>Then</p>
<p><strong>Option 1:</strong></p>
<p>You ccan choose to use <code>Docker Hub</code> instead of Gitlab <code>Container Registry</code>. So in the <code>.gitlab-ci.yml</code> file, insteading of pushing image to <code>Container Registry</code> at <code>docker-build</code> stage, you should push your image to <code>Docker Hub</code> with code</p>
<div class="codeBlockContainer_VY_X theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Emf2"><pre tabindex="0" class="prism-code language-text codeBlock_cEVj thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_o66c"><span class="token-line" style="color:#393A34"><span class="token plain">docker-build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stage: docker-build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  image: docker:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  services:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: docker:20.10.6-dind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  before_script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - docker login -u &quot;$DOCKER_USER&quot; -p &quot;$DOCKER_PASSWORD&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - docker build --pull -t &quot;$DOCKER_USER/$DOCKER_REGISTRY_IMAGE&quot; .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - docker push &quot;$DOCKER_USER/$DOCKER_REGISTRY_IMAGE&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - echo &quot;Registry Image:&quot; $DOCKER_REGISTRY_IMAGE</span><br></span></code></pre><div class="buttonGroup_JuMy"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nyAL" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Qh1x"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_BI7y"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Where <code>DOCKER_USER</code> <code>DOCKER_PASSWORD</code> and <code>DOCKER_REGISTRY_IMAGE</code> are the variables added to your pipeline variables for <code>Docker login user</code>, <code>Docker login password</code> and <code>Docker image name</code></p>
<p>And Skip the <code>deploy</code> stage at the <code>.gitlab-ci.yml</code></p>
<p>Then add Azure App Servicce Webhook URL</p>
<p><img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116197425-54234600-a767-11eb-821c-e99eb5ecaea4.png" alt="image" class="img_GMwV"></p>
<p>to Docker Hub of your repositry.</p>
<p><img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116197789-bda35480-a767-11eb-9981-428ff3579977.png" alt="image" class="img_GMwV"></p>
<p>Then when you push a new image to the docker hub, the Azure App Serivce will deploy your application from Docker Hub immediately.</p>
<p><strong>Option 2:</strong></p>
<p>You can also use <code>Pipeline events</code> to trigger the Azure App Serivce Webhook to force <code>App Serivce</code> to deploy your app from Gitlab Rigstry.</p>
<p>Go to your project <code>Settings</code> -&gt; <code>Webhooks</code>, fill the <code>URL</code> with app service <code>Webhook URL</code> and tick <code>Pipeline events</code></p>
<p><img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/10986601/116210087-234a0d80-a775-11eb-97ac-2cebd0b8ea54.png" alt="image" class="img_GMwV"></p>
<p>And click <code>Add webhook</code> button to save the configuration.</p>
<p>This means App Service Webhook URL will be triggered when the pipeline status changes, from <code>running</code> to either <code>passed</code> or <code>failed</code>. If it is <code>failed</code>, the image will not be uploaded to <code>Container Registry</code> and app service will use the last build. If it is <code>passed</code>, app service will pull the latest image to deploy the app.</p>
<h3 class="anchor anchorWithStickyNavbar_gnyd" id="congratulations-1">Congratulations!<a href="#congratulations-1" class="hash-link" aria-label="Direct link to Congratulations!" title="Direct link to Congratulations!">â€‹</a></h3>
<p>Now you can made some changes on your code and push it to Gitlab. You will see your changes will be applied on Azure App Service.</p>
</li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/TechnicalTutorial/docs/devops/cicd/gitlab/gitlab-backup-and-restore"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Migrate Gitlab from one server to another</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/TechnicalTutorial/docs/devops/containerization/intro"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">intro</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_yKKF thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-setup-a-gitlab-service-on-a-server" class="table-of-contents__link toc-highlight">1. Setup a Gitlab service on a server</a></li><li><a href="#2-install-a-gitlab-runner-better-on-a-seperate-machine" class="table-of-contents__link toc-highlight">2. Install a Gitlab Runner (Better on A Seperate Machine)</a></li><li><a href="#3-create-a-new-project-on-gitlab" class="table-of-contents__link toc-highlight">3. Create a New Project on Gitlab</a></li><li><a href="#3-create-a-reactjs-application-and-push-to-gitlab-repository" class="table-of-contents__link toc-highlight">3. Create a ReactJS Application and Push to Gitlab repository</a></li><li><a href="#4-dockerize-our-application-on-nginx" class="table-of-contents__link toc-highlight">4. Dockerize our application on Nginx</a></li><li><a href="#5-gitlab-pipelines" class="table-of-contents__link toc-highlight">5. Gitlab Pipelines</a><ul><li><a href="#51-pipelines---build" class="table-of-contents__link toc-highlight">5.1 Pipelines - build</a></li><li><a href="#52-pipelines---test" class="table-of-contents__link toc-highlight">5.2 Pipelines - test</a></li><li><a href="#53-pipelines---docker-build" class="table-of-contents__link toc-highlight">5.3 Pipelines - Docker Build</a></li><li><a href="#54-pipelines---deploy" class="table-of-contents__link toc-highlight">5.4 Pipelines - deploy</a></li><li><a href="#congratulations" class="table-of-contents__link toc-highlight">Congratulations!</a></li><li><a href="#congratulations-1" class="table-of-contents__link toc-highlight">Congratulations!</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/TechnicalTutorial/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_SPiH"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_SPiH"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_SPiH"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/TechnicalTutorial/resume">Resume</a></li><li class="footer__item"><a href="https://github.com/PFTian/TechnicalTutorials" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_SPiH"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>